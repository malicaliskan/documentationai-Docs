const { HttpServerError } =
  require("common");

const {<%= dbObject.modelName %>} = require('models');
const { Op } = require("sequelize");
const { ElasticIndexer } = require("serviceCommon");

const update<%= dbObject.modelName %>ByIdList = async (idList,dataClause) => {
  try {

    let rowsCount = null;
    let rows = null;
    <% if (dbObject.objectSettings.basicSettings.useSoftDelete) { %>
    const options =  { where: {id:{[Op.in]:idList}, isActive:true},returning: true,};
    <% } else { %>
    const options =  { where: {id:{[Op.in]:idList}},returning: true,};
    <% } %>
    [rowsCount, rows] = await <%= dbObject.modelName %>.update(dataClause,options);

    const elasticIndexer = new ElasticIndexer("<%= dbObject.objectName %>");
    for (const item of rows) {
      await elasticIndexer.indexData(item.getData());
    }
    
    const <%= dbObject.objectName %>IdList =  rows.map(item => item.id);
    return <%= dbObject.objectName %>IdList;
    } catch (err) {
      //**errorLog
      throw new HttpServerError("errMsg_dbErrorWhenUpdating<%= dbObject.modelName %>ByIdList", err);
    }
};

module.exports = update<%= dbObject.modelName %>ByIdList;