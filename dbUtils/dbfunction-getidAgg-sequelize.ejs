const { HttpServerError, NotFoundError } =
  require("common");
  const { hexaLogger } = require("common");

const {
  <% for (const dbObject of dataModel.objects ) { -%>
  <%= dbObject.modelName %>,
  <% } -%>
  } = require('models');
  const { Op } = require("sequelize");
 
const get<%= dbObject.modelName %>AggById = async (<%= dbObject.objectName %>Id) => {
    try {
      const forWhereClause = false;
      const includes = [];
      <% if (dbObject.objectSettings.basicSettings.useSoftDelete) { %>
      const <%= dbObject.objectName %> = Array.isArray(<%= dbObject.objectName %>Id)
      ? await <%= dbObject.modelName %>.findAll({
          where: {
            id: { [Op.in]: <%= dbObject.objectName %>Id },
            isActive: true
          },
          include: includes,
        })
      : await <%= dbObject.modelName %>.findOne({
          where: {
            id: <%= dbObject.objectName %>Id,
            isActive: true
          },
          include: includes
        });
      <% } else { %>
      const <%= dbObject.objectName %> = Array.isArray(<%= dbObject.objectName %>Id)
      ? await <%= dbObject.modelName %>.findAll({
          where: {
            id: { [Op.in]: <%= dbObject.objectName %>Id },
          },
          include: includes,
        })
      : await <%= dbObject.modelName %>.findByPk(<%= dbObject.objectName %>Id, { include: includes });
      <% } %>

      if (!<%= dbObject.objectName %>) {
        return null;
      }

    const <%= dbObject.objectName %>Data = Array.isArray(<%= dbObject.objectName %>Id) && <%= dbObject.objectName %>Id.length > 0
    ? <%= dbObject.objectName %>.map((item) => item.getData())
    : <%= dbObject.objectName %>.getData();
      await <%= dbObject.modelName %>.getCqrsJoins(<%= dbObject.objectName %>Data);
      return <%= dbObject.objectName %>Data;
      
    } catch (err) {
      //**errorLog
      throw new HttpServerError("errMsg_dbErrorWhenRequesting<%= dbObject.modelName %>AggById", err);
    }
};

module.exports =  get<%= dbObject.modelName %>AggById;