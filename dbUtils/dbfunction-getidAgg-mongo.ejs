const { HttpServerError } =  require("common");

const { <%= dbObject.modelName %> } = require('models');

const get<%= dbObject.modelName %>AggById = async (<%= dbObject.objectName %>Id) => {
  try {
    <% const dbFunction = { dbObject: dbObject } -%>

    let <%= dbObject.objectName %>Query;

    if (Array.isArray(<%= dbObject.objectName %>Id)) {
      <% if (dbObject.objectSettings.basicSettings.useSoftDelete) { %>
      <%= dbObject.objectName %>Query = <%= dbObject.modelName %>.find({
        _id: { $in: <%= dbObject.objectName %>Id },
        isActive: true
      });
      <% } else { %>
      <%= dbObject.objectName %>Query = <%= dbObject.modelName %>.find({
        _id: { $in: <%= dbObject.objectName %>Id }
      });
      <% } %>
    } else {
      <% if (dbObject.objectSettings.basicSettings.useSoftDelete) { %>
      <%= dbObject.objectName %>Query = <%= dbObject.modelName %>.findOne({
        _id: <%= dbObject.objectName %>Id,
        isActive: true
      });
      <% } else { %>
      <%= dbObject.objectName %>Query = <%= dbObject.modelName %>.findById(<%= dbObject.objectName %>Id);
      <% } %>
    }

    // Populate associations as needed
    <%- include('inc.mongoref.populate.ejs', { dbFunction: dbFunction, docName: dbObject.objectName + 'Query' }) %>

    const <%= dbObject.objectName %> = await <%= dbObject.objectName %>Query.exec();

    if (!<%= dbObject.objectName %>){
       return null;
    }
    const <%= dbObject.objectName %>Data = Array.isArray(<%= dbObject.objectName %>Id) && <%= dbObject.objectName %>Id.length > 0
      ? <%= dbObject.objectName %>.map(item => item.getData())
      : <%= dbObject.objectName %>.getData();

// should i add this here? 
    await <%= dbObject.modelName %>.getCqrsJoins(<%= dbObject.objectName %>Data);

    return <%= dbObject.objectName %>Data;

  } catch (err) {
    console.log(err);
    //**errorLog
    throw new HttpServerError("errMsg_dbErrorWhenRequesting<%= dbObject.modelName %>AggById", err);
  }
};

module.exports = get<%= dbObject.modelName %>AggById;
