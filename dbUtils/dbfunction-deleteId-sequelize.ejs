//ask about this no other option other than softdelete
const { HttpServerError, BadRequestError, NotAuthenticatedError, ForbiddenError, NotFoundError } = require("common");
const { <%= dbObject.modelName %> } = require("models");
const { ElasticIndexer } = require("serviceCommon");

const delete<%= dbObject.modelName %>ById = async (id) => {
  try {
    if (typeof id === "object") {
      id = id.id;
    }
    if (!id) throw new BadRequestError("ID is required in utility delete function");
    
    <% if (dbObject.objectSettings.basicSettings.useSoftDelete) { %>
    const existingDoc = await <%= dbObject.modelName %>.findOne({ where: { id, isActive: true } });
    if (!existingDoc){
       throw new NotFoundError(`Record with ID ${id} not found.`);
    }
    const dataClause = { isActive: false, _archivedAt: new Date() };
    await existingDoc.update(dataClause);

    const elasticIndexer = new ElasticIndexer("<%= dbObject.objectName %>");
    await elasticIndexer.deleteData(existingDoc.id);

    return existingDoc.getData();
    <% } else { %>
    const existingDoc = await <%= dbObject.modelName %>.findByPk(id);
    if (!existingDoc){
       throw new NotFoundError(`Record with ID ${id} not found.`);
    }
    
    await existingDoc.destroy();

    const elasticIndexer = new ElasticIndexer("<%= dbObject.objectName %>");
    await elasticIndexer.deleteData(id);

    return existingDoc.getData();
    <% } %>
    
  } catch (err) {
    //**errorLog
    throw new HttpServerError("An unexpected error occurred during the delete operation.", err);
  }
};

module.exports = delete<%= dbObject.modelName %>ById;
