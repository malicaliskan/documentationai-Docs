---
title: MScript Query Operators Reference
description: >-
  Comprehensive reference for all MScript Query operators with their Sequelize,
  MongoDB, and Elasticsearch equivalents, including examples for each operator.
---

MScript Query provides a unified query syntax that works across MongoDB, Elasticsearch, and Sequelize (PostgreSQL, MySQL, etc.). This document provides a complete reference for all available operators, their platform-specific equivalents, and usage examples.

---

## Basic Comparison Operators

### `$eq` - Equals

**Description:** Matches values that are equal to the specified value.

**MScript Query:**
```javascript
{
  status: { $eq: "active" }
}

```

**Shorthand:** You can omit `$eq` for simple equality:
```javascript
{
  status: "active"
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ status: "active" } or { status: { [Op.eq]: "active" } }

```

**MongoDB**
```javascript
{ status: "active" }

```

**Elasticsearch**
```javascript
{ term: { status: { value: "active" } } }

```


**Example:**
```javascript
{
  role: { $eq: "admin" }
}

```

---

### `$ne` - Not Equals

**Description:** Matches values that are not equal to the specified value.

**MScript Query:**
```javascript
{
  status: { $ne: "deleted" }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ status: { [Op.ne]: "deleted" } }

```

**MongoDB**
```javascript
{ status: { $ne: "deleted" } }

```

**Elasticsearch**
```javascript
{ bool: { must_not: { term: { status: { value: "deleted" } } } } }

```


**Example:**
```javascript
{
  isActive: { $ne: false }
}

```

---

### `$gt` - Greater Than

**Description:** Matches values that are greater than the specified value.

**MScript Query:**
```javascript
{
  age: { $gt: 18 }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ age: { [Op.gt]: 18 } }

```

**MongoDB**
```javascript
{ age: { $gt: 18 } }

```

**Elasticsearch**
```javascript
{ range: { age: { gt: 18 } } }

```


**Example:**
```javascript
{
  price: { $gt: 100.50 }
}

```

---

### `$gte` - Greater Than or Equal

**Description:** Matches values that are greater than or equal to the specified value.

**MScript Query:**
```javascript
{
  age: { $gte: 18 }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ age: { [Op.gte]: 18 } }

```

**MongoDB**
```javascript
{ age: { $gte: 18 } }

```

**Elasticsearch**
```javascript
{ range: { age: { gte: 18 } } }

```


**Example:**
```javascript
{
  minimumOrder: { $gte: 50 }
}

```

---

### `$lt` - Less Than

**Description:** Matches values that are less than the specified value.

**MScript Query:**
```javascript
{
  age: { $lt: 65 }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ age: { [Op.lt]: 65 } }

```

**MongoDB**
```javascript
{ age: { $lt: 65 } }

```

**Elasticsearch**
```javascript
{ range: { age: { lt: 65 } } }

```


**Example:**
```javascript
{
  discount: { $lt: 0.5 }
}

```

---

### `$lte` - Less Than or Equal

**Description:** Matches values that are less than or equal to the specified value.

**MScript Query:**
```javascript
{
  age: { $lte: 65 }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ age: { [Op.lte]: 65 } }

```

**MongoDB**
```javascript
{ age: { $lte: 65 } }

```

**Elasticsearch**
```javascript
{ range: { age: { lte: 65 } } }

```


**Example:**
```javascript
{
  maxPrice: { $lte: 1000 }
}

```

---

### `$in` - In List

**Description:** Matches any of the values specified in an array.

**MScript Query:**
```javascript
{
  role: { $in: ["admin", "user", "moderator"] }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ role: { [Op.in]: ["admin", "user", "moderator"] } }

```

**MongoDB**
```javascript
{ role: { $in: ["admin", "user", "moderator"] } }

```

**Elasticsearch**
```javascript
{ terms: { role: ["admin", "user", "moderator"] } }

```


**Example:**
```javascript
{
  status: { $in: ["pending", "processing", "completed"] }
}

```

**Note:** You can also use array shorthand:
```javascript
{
  role: ["admin", "user"]
}

```

---

### `$nin` - Not In List

**Description:** Matches none of the values specified in an array.

**MScript Query:**
```javascript
{
  role: { $nin: ["guest", "banned"] }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ role: { [Op.notIn]: ["guest", "banned"] } }

```

**MongoDB**
```javascript
{ role: { $nin: ["guest", "banned"] } }

```

**Elasticsearch**
```javascript
{ bool: { must_not: { terms: { role: ["guest", "banned"] } } } }

```


**Example:**
```javascript
{
  category: { $nin: ["deleted", "archived"] }
}

```

---

## Pattern Matching Operators

### `$like` - Like Pattern (Case-Sensitive)

**Description:** Matches strings using SQL LIKE pattern matching (case-sensitive). Use `%` as wildcard.

**MScript Query:**
```javascript
{
  name: { $like: "%john%" }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ name: { [Op.like]: "%john%" } }

```

**MongoDB** (Note: MongoDB regex is case-insensitive by default)
```javascript
{ name: { $regex: /john/, $options: "i" } }

```


**Elasticsearch**
```javascript
{ wildcard: { name: "*john*" } }

```



**Example:**
```javascript
{
  email: { $like: "%@gmail.com" }
}

```

---

### `$ilike` - Like Pattern (Case-Insensitive)

**Description:** Matches strings using SQL LIKE pattern matching (case-insensitive). Use `%` as wildcard.

**MScript Query:**
```javascript
{
  name: { $ilike: "%john%" }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ name: { [Op.iLike]: "%john%" } }

```

**MongoDB**
```javascript
{ name: { $regex: /john/i } }

```

**Elasticsearch**
```javascript
{ wildcard: { name: { value: "*john*", case_insensitive: true } } }

```


**Example:**
```javascript
{
  company: { $ilike: "%tech%" }
}

```

---

### `$nlike` - Not Like Pattern

**Description:** Matches strings that do not match the SQL LIKE pattern (case-sensitive).

**MScript Query:**
```javascript
{
  name: { $nlike: "%bot%" }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ name: { [Op.notLike]: "%bot%" } }

```

**MongoDB**
```javascript
{ name: { $not: { $regex: /bot/ } } }

```

**Elasticsearch**
```javascript
{ bool: { must_not: { wildcard: { name: "*bot*" } } } }

```


**Example:**
```javascript
{
  email: { $nlike: "%test%" }
}

```

---

### `$nilike` - Not ILike Pattern

**Description:** Matches strings that do not match the SQL LIKE pattern (case-insensitive).

**MScript Query:**
```javascript
{
  name: { $nilike: "%bot%" }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ name: { [Op.notILike]: "%bot%" } }

```

**MongoDB**
```javascript
{ name: { $not: { $regex: /bot/i } } }

```

**Elasticsearch**
```javascript
{ bool: { must_not: { wildcard: { name: { value: "*bot*", case_insensitive: true } } } } }

```


**Example:**
```javascript
{
  domain: { $nilike: "%spam%" }
}

```

---

### `$match` - Match Regex

**Description:** Matches strings using regular expression pattern.

**MScript Query:**
```javascript
{
  description: { $match: "sale.*discount" }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ description: { [Op.match]: "sale.*discount" } }

```

**MongoDB**
```javascript
{ description: { $regex: "sale.*discount" } }

```

**Elasticsearch**
```javascript
{ match: { description: "sale.*discount" } }

```


**Example:**
```javascript
{
  phone: { $match: "^\\+1[0-9]{10}$" }
}

```

---

### `$nmatch` - Not Match Regex

**Description:** Matches strings that do not match the regular expression pattern.

**MScript Query:**
```javascript
{
  description: { $nmatch: "error.*failed" }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ description: { [Op.notMatch]: "error.*failed" } }

```

**MongoDB**
```javascript
{ description: { $not: { $regex: "error.*failed" } } }

```

**Elasticsearch**
```javascript
{ bool: { must_not: { match: { description: "error.*failed" } } } }

```


**Example:**
```javascript
{
  code: { $nmatch: "^ERROR" }
}

```

---

## Range and Null Check Operators

### `$between` - Value Between Range

**Description:** Matches values that fall within the specified range (inclusive).

**MScript Query:**
```javascript
{
  price: { $between: [10, 100] }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ price: { [Op.between]: [10, 100] } }

```

**MongoDB**
```javascript
{ price: { $gte: 10, $lte: 100 } }

```

**Elasticsearch**
```javascript
{ range: { price: { gte: 10, lte: 100 } } }

```


**Example:**
```javascript
{
  age: { $between: [18, 65] }
}

```

---

### `$nbetween` - Value Not In Range

**Description:** Matches values that fall outside the specified range.

**MScript Query:**
```javascript
{
  price: { $nbetween: [10, 100] }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ price: { [Op.notBetween]: [10, 100] } }

```

**MongoDB**
```javascript
{ $or: [{ price: { $lt: 10 } }, { price: { $gt: 100 } }] }

```

**Elasticsearch**
```javascript
{ bool: { must_not: { range: { price: { gte: 10, lte: 100 } } } } }

```


**Example:**
```javascript
{
  score: { $nbetween: [0, 100] }
}

```

---

### `$isnull` - Is Null

**Description:** Matches fields that are null or do not exist.

**MScript Query:**
```javascript
{
  deletedAt: { $isnull: true }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ deletedAt: { [Op.is]: null } }

```

**MongoDB**
```javascript
{ deletedAt: null }

```

**Elasticsearch**
```javascript
{ bool: { must_not: { exists: { field: "deletedAt" } } } }

```


**Example:**
```javascript
{
  optionalField: { $isnull: true }
}

```

---

### `$notnull` - Is Not Null

**Description:** Matches fields that are not null and exist.

**MScript Query:**
```javascript
{
  deletedAt: { $notnull: true }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ deletedAt: { [Op.not]: null } }

```

**MongoDB**
```javascript
{ deletedAt: { $ne: null } }

```

**Elasticsearch**
```javascript
{ exists: { field: "deletedAt" } }

```


**Example:**
```javascript
{
  email: { $notnull: true }
}

```

---

## Array and String Operations

### `$contains` - Array Contains Value

**Description:** Matches arrays that contain the specified value.

**MScript Query:**
```javascript
{
  tags: { $contains: "news" }
}

```

**Platform Equivalents:**

**Sequelize** (PostgreSQL array operator)
```javascript
{ tags: { [Op.contains]: ["news"] } }

```


**MongoDB**
```javascript
{ tags: { $elemMatch: { $eq: "news" } } }

```


**Elasticsearch**
```javascript
{ match: { tags: "news" } }

```



**Example:**
```javascript
{
  categories: { $contains: "technology" }
}

```

---

### `$ncontains` - Array Does Not Contain Value

**Description:** Matches arrays that do not contain the specified value.

**MScript Query:**
```javascript
{
  tags: { $ncontains: "draft" }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ tags: { [Op.notContains]: ["draft"] } }

```

**MongoDB**
```javascript
{ tags: { $not: { $elemMatch: { $eq: "draft" } } } }

```

**Elasticsearch**
```javascript
{ bool: { must_not: { match: { tags: "draft" } } } }

```


**Example:**
```javascript
{
  excludedTags: { $ncontains: "archived" }
}

```

---

### `$overlap` - Arrays Have Common Elements

**Description:** Matches arrays that have at least one element in common with the specified array.

**MScript Query:**
```javascript
{
  tags: { $overlap: ["tech", "ai"] }
}

```

**Platform Equivalents:**

**Sequelize** (PostgreSQL array operator)
```javascript
{ tags: { [Op.overlap]: ["tech", "ai"] } }

```


**MongoDB**
```javascript
{ tags: { $elemMatch: { $in: ["tech", "ai"] } } }

```


**Elasticsearch**
```javascript
{ match: { tags: ["tech", "ai"] } }

```



**Example:**
```javascript
{
  skills: { $overlap: ["javascript", "python"] }
}

```

---

### `$noverlap` - Arrays Have No Common Elements

**Description:** Matches arrays that have no elements in common with the specified array.

**MScript Query:**
```javascript
{
  tags: { $noverlap: ["old", "deprecated"] }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ [Op.not]: { tags: { [Op.overlap]: ["old", "deprecated"] } } }

```

**MongoDB**
```javascript
{ tags: { $not: { $elemMatch: { $in: ["old", "deprecated"] } } } }

```

**Elasticsearch**
```javascript
{ bool: { must_not: { match: { tags: ["old", "deprecated"] } } } }

```


**Example:**
```javascript
{
  categories: { $noverlap: ["deleted", "archived"] }
}

```

---

### `$starts` - Starts With String

**Description:** Matches strings that start with the specified value.

**MScript Query:**
```javascript
{
  name: { $starts: "Mr." }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ name: { [Op.startsWith]: "Mr." } }

```

**MongoDB**
```javascript
{ name: { $regex: /^Mr\./ } }

```

**Elasticsearch**
```javascript
{ prefix: { name: "Mr." } }

```


**Example:**
```javascript
{
  email: { $starts: "admin@" }
}

```

---

### `$nstarts` - Does Not Start With String

**Description:** Matches strings that do not start with the specified value.

**MScript Query:**
```javascript
{
  name: { $nstarts: "Ms." }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ name: { [Op.notStartsWith]: "Ms." } }

```

**MongoDB**
```javascript
{ name: { $not: { $regex: /^Ms\./ } } }

```

**Elasticsearch**
```javascript
{ bool: { must_not: { prefix: { name: "Ms." } } } }

```


**Example:**
```javascript
{
  path: { $nstarts: "/admin" }
}

```

---

### `$ends` - Ends With String

**Description:** Matches strings that end with the specified value.

**MScript Query:**
```javascript
{
  email: { $ends: "@gmail.com" }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ email: { [Op.endsWith]: "@gmail.com" } }

```

**MongoDB**
```javascript
{ email: { $regex: /@gmail\.com$/ } }

```

**Elasticsearch**
```javascript
{ wildcard: { email: "*@gmail.com" } }

```


**Example:**
```javascript
{
  filename: { $ends: ".pdf" }
}

```

---

### `$nends` - Does Not End With String

**Description:** Matches strings that do not end with the specified value.

**MScript Query:**
```javascript
{
  email: { $nends: "@yahoo.com" }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ email: { [Op.notEndsWith]: "@yahoo.com" } }

```

**MongoDB**
```javascript
{ email: { $not: { $regex: /@yahoo\.com$/ } } }

```

**Elasticsearch**
```javascript
{ bool: { must_not: { wildcard: { email: "*@yahoo.com" } } } }

```


**Example:**
```javascript
{
  url: { $nends: ".exe" }
}

```

---

## Logical Operators

### `$and` - All Conditions Must Be True

**Description:** Combines multiple conditions with AND logic. All conditions must be true.

**MScript Query:**
```javascript
{
  $and: [
    { status: "active" },
    { age: { $gte: 18 } }
  ]
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ [Op.and]: [{ status: "active" }, { age: { [Op.gte]: 18 } }] }

```

**MongoDB**
```javascript
{ $and: [{ status: "active" }, { age: { $gte: 18 } }] }

```

**Elasticsearch**
```javascript
{ bool: { must: [{ term: { status: { value: "active" } } }, { range: { age: { gte: 18 } } }] } }

```


**Example:**
```javascript
{
  $and: [
    { isPublished: true },
    { views: { $gte: 100 } },
    { tags: { $contains: "featured" } }
  ]
}

```

**Note:** Multiple fields at the same level are automatically combined with `$and`:
```javascript
{
  status: "active",
  age: { $gte: 18 }
}

```
This is equivalent to the `$and` example above.

---

### `$or` - At Least One Condition Is True

**Description:** Combines multiple conditions with OR logic. At least one condition must be true.

**MScript Query:**
```javascript
{
  $or: [
    { status: "pending" },
    { status: "processing" }
  ]
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ [Op.or]: [{ status: "pending" }, { status: "processing" }] }

```

**MongoDB**
```javascript
{ $or: [{ status: "pending" }, { status: "processing" }] }

```

**Elasticsearch**
```javascript
{ bool: { should: [{ term: { status: { value: "pending" } } }, { term: { status: { value: "processing" } } }] } }

```


**Example:**
```javascript
{
  $or: [
    { views: { $gte: 1000 } },
    { likes: { $gte: 500 } }
  ]
}

```

---

### `$not` - Negates a Condition

**Description:** Negates the specified condition.

**MScript Query:**
```javascript
{
  $not: {
    status: "deleted"
  }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ [Op.not]: { status: "deleted" } }

```

**MongoDB**
```javascript
{ $not: { status: "deleted" } }

```

**Elasticsearch**
```javascript
{ bool: { must_not: { term: { status: { value: "deleted" } } } } }

```


**Example:**
```javascript
{
  $not: {
    role: { $in: ["guest", "banned"] }
  }
}

```

---

### `$nor` - None of the Conditions Are True

**Description:** Matches documents where none of the specified conditions are true.

**MScript Query:**
```javascript
{
  $nor: [
    { status: "deleted" },
    { isArchived: true }
  ]
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ [Op.not]: [{ status: "deleted" }, { isArchived: true }] }

```

**MongoDB**
```javascript
{ $nor: [{ status: "deleted" }, { isArchived: true }] }

```

**Elasticsearch**
```javascript
{ bool: { must_not: [{ term: { status: { value: "deleted" } } }, { term: { isArchived: { value: true } } }] } }

```


**Example:**
```javascript
{
  $nor: [
    { role: "guest" },
    { isBanned: true }
  ]
}

```

---

## MongoDB-Specific Operators

These operators are primarily designed for MongoDB but may have limited support in other platforms.

### `$exists` - Field Exists

**Description:** Matches documents that have the specified field (MongoDB-specific).

**MScript Query:**
```javascript
{
  optionalField: { $exists: true }
}

```

**Platform Equivalents:**

**Sequelize** (similar behavior)
```javascript
{ optionalField: { [Op.not]: null } }

```


**MongoDB**
```javascript
{ optionalField: { $exists: true } }

```


**Elasticsearch**
```javascript
{ exists: { field: "optionalField" } }

```



**Example:**
```javascript
{
  metadata: { $exists: true }
}

```

---

### `$nexists` - Field Does Not Exist

**Description:** Matches documents that do not have the specified field (MongoDB-specific).

**MScript Query:**
```javascript
{
  deletedAt: { $nexists: true }
}

```

**Platform Equivalents:**

**Sequelize** (similar behavior)
```javascript
{ deletedAt: { [Op.is]: null } }

```


**MongoDB**
```javascript
{ deletedAt: { $exists: false } }

```


**Elasticsearch**
```javascript
{ bool: { must_not: { exists: { field: "deletedAt" } } } }

```



**Example:**
```javascript
{
  tempField: { $nexists: true }
}

```

---

### `$all` - Array Contains All Values

**Description:** Matches arrays that contain all of the specified values (MongoDB-specific).

**MScript Query:**
```javascript
{
  tags: { $all: ["tech", "ai", "machine-learning"] }
}

```

**Platform Equivalents:**

**Sequelize** (PostgreSQL)
```javascript
{ tags: { [Op.contains]: ["tech", "ai", "machine-learning"] } }

```


**MongoDB**
```javascript
{ tags: { $all: ["tech", "ai", "machine-learning"] } }

```


**Elasticsearch**
```javascript
{ match: { tags: { query: "tech ai machine-learning", operator: "and" } } }

```



**Example:**
```javascript
{
  requiredSkills: { $all: ["javascript", "react", "nodejs"] }
}

```

---

### `$notall` - Array Does Not Contain All Values

**Description:** Matches arrays that do not contain all of the specified values (MongoDB-specific).

**MScript Query:**
```javascript
{
  tags: { $notall: ["premium", "featured"] }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ [Op.not]: { tags: { [Op.contains]: ["premium", "featured"] } } }

```

**MongoDB**
```javascript
{ tags: { $not: { $all: ["premium", "featured"] } } }

```

**Elasticsearch**
```javascript
{ bool: { must_not: { match: { tags: { query: "premium featured", operator: "and" } } } } }

```


**Example:**
```javascript
{
  skills: { $notall: ["expert", "certified"] }
}

```

---

### `$size` - Array Size

**Description:** Matches arrays with exactly the specified number of elements (MongoDB-specific).

**MScript Query:**
```javascript
{
  tags: { $size: 3 }
}

```

**Platform Equivalents:**

**Sequelize** (PostgreSQL)
```javascript
Sequelize.where(Sequelize.fn('array_length', Sequelize.col('tags'), 1), 3)

```


**MongoDB**
```javascript
{ tags: { $size: 3 } }

```


**Elasticsearch**
```javascript
{ script: { script: { source: "doc['tags'].size() == 3" } } }

```



**Example:**
```javascript
{
  items: { $size: 5 }
}

```

---

### `$notsize` - Array Size Not Equal

**Description:** Matches arrays that do not have the specified number of elements (MongoDB-specific).

**MScript Query:**
```javascript
{
  tags: { $notsize: 0 }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
Sequelize.where(Sequelize.fn('array_length', Sequelize.col('tags'), 1), { [Op.ne]: 0 })

```

**MongoDB**
```javascript
{ tags: { $not: { $size: 0 } } }

```

**Elasticsearch**
```javascript
{ bool: { must_not: { script: { script: { source: "doc['tags'].size() == 0" } } } } }

```


**Example:**
```javascript
{
  items: { $notsize: 1 }
}

```

---

### `$any` - Array Contains Any Value

**Description:** Matches arrays that contain any of the specified values (MongoDB-specific, similar to `$overlap`).

**MScript Query:**
```javascript
{
  tags: { $any: ["tech", "ai"] }
}

```

**Platform Equivalents:**

**Sequelize** (Note: `Op.overlap` is `Sequelize.Op.overlap`, PostgreSQL)
```javascript
{ tags: { Op.overlap: ["tech", "ai"] } }

```


**MongoDB**
```javascript
{ tags: { $elemMatch: { $in: ["tech", "ai"] } } }

```


**Elasticsearch**
```javascript
{ match: { tags: ["tech", "ai"] } }

```



**Example:**
```javascript
{
  categories: { $any: ["news", "blog", "article"] }
}

```

---

### `$notany` - Array Does Not Contain Any Value

**Description:** Matches arrays that do not contain any of the specified values (MongoDB-specific).

**MScript Query:**
```javascript
{
  tags: { $notany: ["deleted", "archived"] }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
{ [Op.not]: { tags: { [Op.overlap]: ["deleted", "archived"] } } }

```

**MongoDB**
```javascript
{ tags: { $not: { $elemMatch: { $in: ["deleted", "archived"] } } } }

```

**Elasticsearch**
```javascript
{ bool: { must_not: { match: { tags: ["deleted", "archived"] } } } }

```


**Example:**
```javascript
{
  excludedCategories: { $notany: ["spam", "test"] }
}

```

---

## Geographic Operators

### `$geoNear` - Geographic Distance

**Description:** Finds documents near a geographic point within a specified distance.

**MScript Query:**
```javascript
{
  location: {
    $geoNear: {
      point: {
        type: "Point",
        coordinates: [-122.4194, 37.7749]
      },
      maxDistance: 5000,
      minDistance: 100
    }
  }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
Sequelize.where(Sequelize.fn('ST_DWithin', Sequelize.col('location'), Sequelize.literal('ST_SetSRID(ST_MakePoint(-122.4194, 37.7749),4326)::geography'), 5000), true)

```

**MongoDB**
```javascript
{ location: { $nearSphere: { $geometry: { type: "Point", coordinates: [-122.4194, 37.7749] }, $maxDistance: 5000, $minDistance: 100 } } }

```

**Elasticsearch**
```javascript
{ geo_distance: { distance: "5000m", location: { lon: -122.4194, lat: 37.7749 } } }

```


**Example:**
```javascript
{
  coordinates: {
    $geoNear: {
      point: {
        type: "Point",
        coordinates: [28.9784, 41.0082]
      },
      maxDistance: 10000
    }
  }
}

```

**Note:** 
- `point` must be a GeoJSON Point object with `type: "Point"` and `coordinates: [longitude, latitude]`
- `maxDistance` is required and specified in meters
- `minDistance` is optional and specified in meters

---

### `$geoWithin` - Geographic Containment

**Description:** Finds documents within a geographic boundary (polygon or bounding box).

**MScript Query (with bounding box):**
```javascript
{
  location: {
    $geoWithin: {
      bbox: [-122.5, 37.7, -122.3, 37.8]
    }
  }
}

```

**MScript Query (with GeoJSON shape):**
```javascript
{
  location: {
    $geoWithin: {
      shape: {
        type: "Polygon",
        coordinates: [[
          [-122.5, 37.7],
          [-122.3, 37.7],
          [-122.3, 37.8],
          [-122.5, 37.8],
          [-122.5, 37.7]
        ]]
      }
    }
  }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
Sequelize.where(Sequelize.fn('ST_Within', Sequelize.literal('("location")::geometry'), Sequelize.literal('ST_MakeEnvelope(-122.5, 37.7, -122.3, 37.8, 4326)')), true)

```

**MongoDB**
```javascript
{ location: { $geoWithin: { $box: [[-122.5, 37.7], [-122.3, 37.8]] } } } or { location: { $geoWithin: { $geometry: { type: "Polygon", coordinates: [...] } } } }

```

**Elasticsearch**
```javascript
{ geo_bounding_box: { location: { top_left: { lon: -122.5, lat: 37.8 }, bottom_right: { lon: -122.3, lat: 37.7 } } } } or { geo_polygon: { location: { points: [{ lon: -122.5, lat: 37.7 }, ...] } } }

```

**Example:**
```javascript
{
  coordinates: {
    $geoWithin: {
      bbox: [28.9, 41.0, 29.0, 41.1]
    }
  }
}

```

**Note:**
- `bbox` format: `[minLon, minLat, maxLon, maxLat]`
- `shape` must be a valid GeoJSON Polygon or MultiPolygon

---

### `$geoContains` - Geographic Contains

**Description:** Finds documents where the field (polygon/area) contains the specified point or shape.

**MScript Query:**
```javascript
{
  serviceArea: {
    $geoContains: {
      shape: {
        type: "Point",
        coordinates: [-122.4194, 37.7749]
      }
    }
  }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
Sequelize.where(Sequelize.fn('ST_Contains', Sequelize.literal('("serviceArea")::geometry'), Sequelize.literal('ST_SetSRID(ST_GeomFromGeoJSON(\'{type:"Point",coordinates:[-122.4194,37.7749]}\'),4326)')), true)

```

**MongoDB**
```javascript
{ serviceArea: { $geoIntersects: { $geometry: { type: "Point", coordinates: [-122.4194, 37.7749] } } } }

```

**Elasticsearch**
```javascript
{ geo_shape: { serviceArea: { shape: { type: "Point", coordinates: [-122.4194, 37.7749] }, relation: "contains" } } }

```


**Example:**
```javascript
{
  deliveryZone: {
    $geoContains: {
      shape: {
        type: "Point",
        coordinates: [28.9784, 41.0082]
      }
    }
  }
}

```

**Note:** The field must be a geographic polygon/area type. The shape can be a Point, Polygon, or other GeoJSON geometry.

---

### `$geoIntersects` - Geographic Intersection

**Description:** Finds documents where the field intersects with the specified shape.

**MScript Query:**
```javascript
{
  route: {
    $geoIntersects: {
      shape: {
        type: "Polygon",
        coordinates: [[
          [-122.5, 37.7],
          [-122.3, 37.7],
          [-122.3, 37.8],
          [-122.5, 37.8],
          [-122.5, 37.7]
        ]]
      }
    }
  }
}

```

**Platform Equivalents:**

**Sequelize**
```javascript
Sequelize.where(Sequelize.fn('ST_Intersects', Sequelize.literal('("route")::geometry'), Sequelize.literal('ST_SetSRID(ST_GeomFromGeoJSON(\'{type:"Polygon",...}\'),4326)')), true)

```

**MongoDB**
```javascript
{ route: { $geoIntersects: { $geometry: { type: "Polygon", coordinates: [...] } } } }

```

**Elasticsearch**
```javascript
{ geo_shape: { route: { shape: { type: "Polygon", coordinates: [...] }, relation: "intersects" } } }

```


**Example:**
```javascript
{
  boundary: {
    $geoIntersects: {
      shape: {
        type: "LineString",
        coordinates: [[28.9, 41.0], [29.0, 41.1]]
      }
    }
  }
}

```

**Note:** The shape can be any GeoJSON geometry type (Point, LineString, Polygon, etc.).

---

## Complex Query Examples

### Combining Multiple Operators

```javascript
{
  $and: [
    { status: "active" },
    {
      $or: [
        { age: { $gte: 18 } },
        { isVerified: true }
      ]
    },
    { tags: { $overlap: ["premium", "featured"] } },
    { email: { $ilike: "%@gmail.com" } }
  ]
}

```

### Nested Logical Operators

```javascript
{
  $and: [
    { isPublished: true },
    {
      $or: [
        { views: { $gte: 1000 } },
        {
          $and: [
            { likes: { $gte: 500 } },
            { comments: { $gte: 100 } }
          ]
        }
      ]
    },
    { deletedAt: { $isnull: true } }
  ]
}

```

### Geographic Search with Filters

```javascript
{
  $and: [
    {
      location: {
        $geoNear: {
          point: {
            type: "Point",
            coordinates: [-122.4194, 37.7749]
          },
          maxDistance: 5000
        }
      }
    },
    { isActive: true },
    { category: { $in: ["restaurant", "cafe"] } }
  ]
}

```

---

## Platform-Specific Notes

### Sequelize (PostgreSQL/MySQL)

- Array operators (`$contains`, `$overlap`) work best with PostgreSQL array columns
- Geographic operators require PostGIS extension for PostgreSQL
- `$ilike` is PostgreSQL-specific; MySQL uses case-insensitive collation
- `$match` uses database-specific regex syntax

### MongoDB

- Native support for all operators
- Geographic operators require geospatial indexes
- Array operators work with MongoDB arrays
- `$exists` and `$nexists` are MongoDB-native concepts

### Elasticsearch

- Uses Elasticsearch Query DSL
- Geographic queries require geo_point or geo_shape field mappings
- Array fields are typically analyzed as text, so array operators may behave differently
- Pattern matching uses Elasticsearch wildcard or match queries

---

## Best Practices

1. **Use `$ilike` instead of `$like`** for case-insensitive searches when possible
2. **Combine conditions explicitly** with `$and` when logic is complex
3. **Use `$in` for multiple exact matches** instead of multiple `$or` conditions
4. **Leverage `$between` for range queries** instead of combining `$gte` and `$lte`
5. **Use `$isnull`/`$notnull`** for null checks instead of `$eq: null` or `$ne: null`
6. **Index fields** used in queries for better performance
7. **Test geographic queries** carefully as coordinate systems and precision vary by platform

---

## Related Documentation

- [MScript Syntax Guide](./mscript-syntax) â€” Complete MScript syntax reference